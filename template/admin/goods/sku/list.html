{extend name="/layer" /} {block name="main"}
<div class="x-body">
    <form class="layui-form top-search-form" action="" style="width:800px" onsubmit="return false;">
        <div class="layui-form-pane">
            <div class="layui-form-item x-left">
                <div class="layui-input-inline">
                    <select class="layui-input" name="status">
                        <option value="0">请选择状态</option>
                        {volist name="goodsStatus" id="status"}
                        <option value="{$key}">{$status}</option>
                        {/volist}
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input class="layui-input" placeholder="开始日期" id="start" name="start">
                </div>
                <div class="layui-input-inline">
                    <input class="layui-input" placeholder="截止日期" id="end" name="end">
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="keyword" placeholder="请输入关键字" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-input-inline" style="width:40px">
                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="form-search">
                        <i class="fa fa-search"></i></button>
                </div>
                <div class="layui-input-inline" style="width:40px" id="refresh-window">
                    <a class="layui-btn layui-btn-sm" href="">
                        <i class="fa fa-refresh"></i>
                    </a>
                </div>
            </div>
            <div class="layui-form-item btn-group-define" style="display: none;">
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm layui-btn-danger" id="item-batch-del">
                        <i class="fa fa-trash-o"></i>禁用</button>
                </div>
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm" id="item-batch-open">
                        <i class="fa fa-check-square-o"></i>启用</button>
                </div>
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm" id="item-batch-up">
                        <i class="fa fa-arrow-circle-o-up"></i>上架</button>
                </div>
            </div>
        </div>
    </form>
    <div class="table_box"></div>
    <div id="page"></div>
</div>
<script>
var listConfig = tableList = {};
window.recall = function(){
    //监听提交
    form.on('submit(form-search)', function(data) {
        var field = data.field;
        var where = tableList.config.getWhere();
        if (field.status && field.status != 0) {
            where['a.status'] = field.status;
        }
        if (field.start) {
            where['a.addtime'] = ['>=', field.start + ' 00:00:00'];
        }
        if (field.end) {
            where['a.addtime'] = ['<=', field.end + ' 23:59:59'];
        }

        if (field.start && field.end) {
            where['a.addtime'] = ['between', [field.start + ' 00:00:00', field.end + ' 23:59:59']];
        }
        if (field.keyword) {
            where['b.title|b.desc'] = ['like', '%' + field.keyword + '%'];
        }
        tableList.config.where = where;
        tableList.search();
        return false;
    });

    $("#item-batch-open").on('click', function() {
        var ids = tableList.getChecked();
        dealItem('{:url($ctrl."/".$action."_deal")}', ids, 1);
    });

    $("#item-batch-del").on('click', function() {
        var ids = tableList.getChecked();
        dealItem('{:url($ctrl."/".$action."_deal")}', ids, 2);
    });

    $("#item-batch-up").on('click', function() {
        var ids = tableList.getChecked();
        dealItem('{:url($ctrl."/".$action."_up")}', ids, 3,'确定要上架已选中的商品SKU吗?');
    });

    //弹出窗口全局变量
    listConfig = {
        blockBox: '.table_box',
        blockBoxHeight: 'window',
        jsonUrl: '{:url($ctrl."/".$action."_list")}',
        where: '',
        getWhere: function() {
            var where = {};
            return where;
        },
        widthType: 'tdw',
        pageNum: 10,
        nowPage: 1,
        orderName: "id",
        orderDirection: "asc",
        dataContextMenuOpen: true,
        showPageNav: true,
        loading: true,
        // dealParam: {
            // selector: '.et_tbody tr',
            // items: {
            //     "open": {
            //         name: "启用",
            //         icon: "check-square-o",
            //         field:'status',
            //         values:[2],
            //         callback: function(id) {
            //             dealItem('{:url($ctrl."/".$action."_deal")}', id, 1);
            //         }
            //     },
            //     "close": {
            //         name: "禁用",
            //         icon: "trash-o",
            //         field:'status',
            //         values:[1,3],
            //         callback: function(id) {
            //             dealItem('{:url($ctrl."/".$action."_deal")}', id, 2);
            //         }
            //     },
            //     "up": {
            //         name: "上架",
            //         icon: "arrow-circle-o-up",
            //         field:'status',
            //         values:[1],
            //         callback: function(id) {
            //             dealItem('{:url($ctrl."/".$action."_up")}', id, 3,'您确定要上架该商品吗？');
            //         }
            //     },
            //     "edit": {
            //         name: "编辑",
            //         icon: "edit",
            //         callback: function(id) {
            //             var title = '编辑',
            //                 url = '{:url($ctrl."/".$action."_edit")}?id=' + id;
            //             xAdminShow(title, url);
            //         }
            //     },
            // }
        // },
        colModel: [{
            display: 'checkbox',
            name: 'id',
            width: '15px'
        }, {
            display: '商品名称',
            name: 'title',
        }, {
            display: '商品编号',
            name: 'goodsno',
        }, {
            display: '属性',
            name: 'attrStr',
        }, {
            display: 'SKU编号',
            name: 'skuno',
        }, {
            display: 'sku价格',
            name: 'price',
        }, {
            display: 'sku市场价',
            name: 'saleprice',
        }, {
            display: '重量[千克]',
            name: 'weight',
        }, {
            display: '添加日期',
            name: 'addtime',
        }]
    };
    //实例化列表
    tableList = $('.table_box').EtGrid(listConfig);
}
</script>
{/block}
