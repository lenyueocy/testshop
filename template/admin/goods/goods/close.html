{extend name="/layout" /}
{block name="asset"}
<script src="/plugins/ubbeditor/ubbEditor.js?v={$Think.PROJECT_VERSION}" type="text/javascript"></script>
{/block}
{block name="main"}
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin my-layout-admin ">
    {:$html->formBegin($detail['id'])}
    <div class="layui-body" style="top: 0;">
        <div class="layui-tab">
            <ul class="layui-tab-title">
                <li class="layui-this">基本信息</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    {:$html->input([
                    'label'=>'休市开始',
                    'lay-verify'=>'required',
                    'name'=>'salestart',
                    'value'=>$detail['salestart']
                    ])}
                    {:$html->input([
                    'label'=>'休市结束',
                    'lay-verify'=>'required',
                    'name'=>'saleend',
                    'value'=>$detail['saleend']
                    ])}
                    {:$html->input([
                    'label'=>'休市图片',
                    'lay-verify'=>'required',
                    'name'=>'images',
                    'placeholder'=>'点击选择图片',
                    'value'=>$detail['images']
                    ])}
                    <div class="layui-form-item" pane>
                        <label class="layui-form-label">规则状态</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="isopen"   lay-skin="switch" lay-text="开启|关闭" lay-filter="isopen"  {$detail['isopen'] == 1 ? 'checked' : ''}>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {:$html->formEnd('','sub-form')}
</div>
</body>
<script type="text/javascript">
    var chooseFile = function(file,obj){
        if(file[0]){
            obj.val(file[0].key);
        }else{
            obj.val("");
        }

    };
    window.recall = function(){
        laydate.render({
            elem: '#layinput-salestart',
            type: 'datetime'
        });
        laydate.render({
            elem: '#layinput-saleend',
            type: 'datetime'
        });

        $("#layinput-images").on("click",function(){
            window.uploadConfig = {
                num : 1,
                container : $(this),
                mark : 'single',
                chooseFunc : chooseFile
            }
            tools.adminShow('休市图片',"{:url('file/choose')}");
        });
        form.on('submit(sub-form)', function(data){
            var isopen = $("input[name=isopen]").parent().find(".layui-form-switch").hasClass("layui-form-onswitch") ? 1 :0;
            var data= {"id":data.field.id,"saleend":data.field.saleend,"salestart":data.field.salestart,"isopen":isopen,"images":data.field.images};
            tools.ajax('{:url($ctrl."/".$action."_close")}',data,function(){
                layer.success('编辑成功');
                setTimeout(function(){
                    tools.adminClose();
                    parent.window.pageTool.refresh();
                },1500);

            });
            // return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    }
</script>
{/block}