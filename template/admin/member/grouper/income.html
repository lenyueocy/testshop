{extend name="/layout" /} 
{block name="main"}
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin my-layout-admin">
		<div class="layui-header">
			<form class="layui-form top-search-form" action="" onsubmit="return false;">
		        <div class="layui-form-pane">
		        	<div class="layui-form-item">
		                <div class="layui-input-inline">
		                    <input type="text" name="keyword" placeholder="请输入关键字" autocomplete="off" class="layui-input">
		                </div>
		                <div class="layui-input-inline" style="width:40px">
		                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="form-search">
		                        <i class="fa fa-search"></i></button>
		                </div>
		                <div class="layui-input-inline" style="width:40px">
		                    <a class="layui-btn layui-btn-sm" href="">
		                        <i class="fa fa-refresh"></i>
		                    </a>
		                </div>
		            </div>
					<div class="layui-btn-group layui-layout-right">
					</div>
		        </div>
		    </form>
		</div>
		<div class="layui-body" id="table-box" style="padding:5px;"></div>
		<div class="layui-footer" id="page-box"></div>
	</div>
</body>
<script>
window.recall=function(){
    //监听提交
    form.on('submit(form-search)', function(data) {
        var field = data.field;
        var searchWhere = {};
        if (field.keyword) {
            searchWhere['b.orderno|c.nickname'] = ['like', '%' + field.keyword + '%'];
        }
        adminTable.search(searchWhere);
        return false;
    });


    tools.table({
        jsonUrl: "{:url($ctrl.'/'.$action.'_income')}",
        getWhere:function(){
        	return {'a.userid':'{$Think.get.id}'};
        },
        dealParam: {
        },
        colModel: [{
            display: '团员昵称',
            name: 'nickname',
            dealItem:function(row){
            	return '<div class="text-wrap" style="width:100px;">'+(row.nickname || "")+'</div>';
            }
        }, {
            display: '订单号',
            name: 'orderno',
            dealItem:function(row){
            	return row.orderno || ''
            }
        }, {
            display: '订单金额',
            name: 'orderfee'
        }, {
            display: '抽佣比例',
            name: 'scale'
        }, {
            display: '佣金',
            name: 'scalefee'
        }, {
            display: '类型',
            name: 'type',
            dealItem:function(row){
            	var typeCfg = {
	            	1:'<span class="layui-badge">收入</span>',
	          		2:'<span class="layui-badge layui-bg-orange">结算</span>',
            	};
            	return typeCfg[row.type];
            }
        }, {
            display: '添加时间',
            name: 'addtime'
        }, /*{
            display: '操作',
            icon: 'fa fa-cog',
            width: '80px',
            name: 'dealtools'
        }*/]
    });
}
</script>
{/block}
