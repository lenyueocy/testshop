{extend name="/layer" /} {block name="main"}
<div class="x-body">
    <form class="layui-form top-search-form" action="" style="width:800px" onsubmit="return false;">
        <div class="layui-form-pane">
            <div class="layui-form-item x-left">
                <div class="layui-input-inline">
                    <select class="layui-input" name="status">
                        <option value="0">请选择状态</option>
                        {volist name="statusConfig" id="status"}
                        <option value="{$key}">{$status}</option>
                        {/volist}
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input class="layui-input" placeholder="开始日期" id="start" name="start">
                </div>
                <div class="layui-input-inline">
                    <input class="layui-input" placeholder="截止日期" id="end" name="end">
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="keyword" placeholder="请输入关键字" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-input-inline" style="width:40px">
                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="form-search">
                        <i class="fa fa-search"></i></button>
                </div>
                <div class="layui-input-inline" style="width:40px" id="refresh-window">
                    <a class="layui-btn layui-btn-sm" href="">
                        <i class="fa fa-refresh"></i>
                    </a>
                </div>
            </div>
            <div class="layui-form-item btn-group-define">
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm" id="item-add">
                        <i class="fa fa-plus-circle"></i>添加</button>
                </div>
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm layui-btn-danger" id="item-batch-del">
                        <i class="fa fa-trash-o"></i>删除</button>
                </div>
                <!-- <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-sm" id="item-batch-open">
                        <i class="fa fa-check-square-o"></i>启用</button>
                </div> -->
            </div>
        </div>
    </form>
    <div class="table_box"></div>
    <div id="page"></div>
</div>
<script>
var listConfig = tableList = {};
window.recall = function(){
    //监听提交
    form.on('submit(form-search)', function(data) {
        var field = data.field;
        var where = tableList.config.getWhere();
        if (field.status && field.status != 0) {
            where['status'] = field.status;
        }
        if (field.start) {
            where['addtime'] = ['>=', field.start + ' 00:00:00'];
        }
        if (field.end) {
            where['addtime'] = ['<=', field.end + ' 23:59:59'];
        }

        if (field.start && field.end) {
            where['addtime'] = ['between', [field.start + ' 00:00:00', field.end + ' 23:59:59']];
        }
        if (field.keyword) {
            where['title|desc'] = ['like', '%' + field.keyword + '%'];
        }
        tableList.config.where = where;
        tableList.search();
        return false;
    });

    $("#item-add").on('click', function() {
        var title = '添加',
            url = '{:url($ctrl."/".$action."_add")}';
        xAdminShow(title, url);
    });

    $("#item-batch-open").on('click', function() {
        var ids = tableList.getChecked();
        dealItem('{:url($ctrl."/".$action."_deal")}', ids, 1);
    });

    $("#item-batch-del").on('click', function() {
        var ids = tableList.getChecked();
        dealItem('{:url($ctrl."/".$action."_deal")}', ids, 2,'确定要删除已选中的属性分类吗？');
    });

    //弹出窗口全局变量
    listConfig = {
        jsonUrl: '{:url($ctrl."/".$action."_list")}',
        where: '',
        getWhere: function() {
            var where = {};
            return where;
        },
        pageNum: 10,
        nowPage: 1,
        loading: true,
        dealParam: {
            selector: '.et_tbody tr',
            items: {
                // "open": {
                //     name: "启用",
                //     icon: "check-square-o",
                //     field:'status',
                //     values:[2],
                //     callback: function(id) {
                //         dealItem('{:url($ctrl."/".$action."_deal")}', id, 1);
                //     }
                // },
                // "close": {
                //     name: "禁用",
                //     icon: "trash-o",
                //     field:'status',
                //     values:[1],
                //     callback: function(id) {
                //         dealItem('{:url($ctrl."/".$action."_deal")}', id, 2);
                //     }
                // },
                "edit": {
                    name: "编辑",
                    icon: "edit",
                    callback: function(id) {
                        var title = '编辑',
                            url = '{:url($ctrl."/".$action."_edit")}?id=' + id;
                        xAdminShow(title, url);
                    }
                },
            }
        },
        colModel: [{
            display: 'checkbox',
            name: 'id',
            width: '15px'
        }, {
            display: '名称',
            name: 'title',
        }, {
            display: '描述',
            name: 'desc',
        }, {
            display: '添加日期',
            name: 'addtime',
        }, {
            display: '操作',
            name: 'dealtools',
        }, ]
    };
    //实例化列表
    tableList = $('.table_box').EtGrid(listConfig);
}
</script>
{/block}
