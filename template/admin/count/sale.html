{extend name="/layout" /} 
{block name="asset"}
	<script src="//code.highcharts.com/highcharts.js"></script>
<style type="text/css">
	.count {
		display: inline-block;
		height: 30px;
		line-height: 30px;
		padding: 0 18px;
		background-color: #009688;
		color: #fff;
		white-space: nowrap;
		text-align: center;
		font-size: 14px;
		border: none;
		border-radius: 2px;
		cursor: pointer;
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
</style>
{/block}
{block name="main"}
	<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin my-layout-admin">
		<div class="layui-header">
			<form class="layui-form top-search-form" action="" onsubmit="return false;">
		        <div class="layui-form-pane">
		        	<div class="layui-form-item">
		        		<div class="layui-input-inline" style="width: 150px;">
	                    	<input class="layui-input" placeholder="开始日期" id="start" name="start">
		                </div>
		                <div class="layui-input-inline" style="width: 150px;">
		                    <input class="layui-input" placeholder="截止日期" id="end" name="end">
		                </div>
		                <div class="layui-input-inline" style="width:40px">
		                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="form-search">
		                        <i class="fa fa-search"></i></button>
		                </div>
		                <div class="layui-input-inline" style="width:40px">
		                    <a class="layui-btn layui-btn-sm" href="">
		                        <i class="fa fa-refresh"></i>
		                    </a>
		                </div>
						<div class="count" >
							<div class="title">月销售额统计</div>
						</div>
		            </div>

		        </div>

		    </form>
		</div>
		<div class="layui-body" id="container"></div>
	</div>
</body>
	<script>
	window.recall = function(){
		getData();
		form.on('submit(form-search)', function(data) {
	        getData(data.field);
            get(data.field);
		});
        $(".count").on("click",function(){
            get();
            form.on('submit(form-search)', function(data) {
                get(data.field);
            });
        });
	}

	function getData(where){
		where = where || {};
		tools.ajax("{:url('count/count_sale')}",where,function(res){
			var chart = Highcharts.chart('container', {
			    title: {
			        text: '日销售额统计'
			    },
			    xAxis: {
			        categories: res.x,
			    },
			    yAxis: {
			        title: {
			            text: '销售额'
			        }
			    },
			    credits:{
			    	enabled:false
			    },
			    plotOptions: {
			        line: {
			            dataLabels: {
			                enabled: true,
			                format: '{y} 元'
			            },
			            enableMouseTracking: false
			        }
			    },
			    legend: {
			        enabled: false
			    },
			    series: [{
			        name: '销售额',
			        data: res.y
			    }]
			});
		});

	}
    function get(where){
        where = where || {};
        tools.ajax("{:url('count/count_count')}",where,function(res){
            var chart = Highcharts.chart('container', {
                title: {
                    text: '月销售额统计'
                },
                xAxis: {
                    categories: res.x,
                },
                yAxis: {
                    title: {
                        text: '销售额'
                    }
                },
                credits:{
                    enabled:false
                },
                plotOptions: {
                    line: {
                        dataLabels: {
                            enabled: true,
                            format: '{y} 元'
                        },
                        enableMouseTracking: false
                    }
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: '销售额',
                    data: res.y
                }]
            });
        });

    }
	</script>
{/block}
